"use strict";var i=require("child_process"),p=["fish","zsh","bash","powershell","cmd","pwsh","nu","dash","ksh","tcsh","csh","sh"];function u(t){let s=(0,i.spawnSync)("ps",["-p",t.toString(),"-o","comm="]);if(console.log("getNameUnix",s?.stdout?.toString()),!s.stdout||s.status!==0)return;let n=s.stdout.toString().trim();if(n)return l(n)}function a(t){let s=(0,i.spawnSync)("ps",["-p",t.toString(),"-o","ppid="]);if(console.log("getPpidUnix",s?.stdout?.toString()),!s.stdout||s.status!==0)return;let e=+s.stdout.toString().trim();if(Number.isInteger(e))return e}function c(t){let s=`$p = (Get-CimInstance -ClassName Win32_Process -Filter "ProcessId = ${t}"); Write-Output $p.Name`,n=(0,i.spawnSync)("powershell",["-c",s]);if(console.log("getNameWindows",n?.stdout?.toString()),!n.stdout||n.status!==0)return;let e=n.stdout.toString().trim();return l(e)}function m(t){let s=`$p = (Get-CimInstance -ClassName Win32_Process -Filter "ProcessId = ${t}"); Write-Output $p.ParentProcessId`,n=(0,i.spawnSync)("powershell",["-c",s]);if(console.log("getPpidWindows",n?.stdout?.toString()),!n.stdout||n.status!==0)return;let r=+n.stdout.toString().trim();if(Number.isInteger(r))return r}function g(t){let s=process.platform==="win32"?m:a,n=process.platform==="win32"?c:u,e=s(t);if(!e)return;let r=n(e);if(r)return{pid:e,name:r}}function f(t){return p.includes(t)}function h(t){let s={powershell:["-c","$PSVersionTable.PSVersion -replace '\\D', '.'"],ksh:["-c","echo $KSH_VERSION"]}[t]??["--version"],n=(0,i.spawnSync)(t,s);console.log("getShellVersion",n?.stdout?.toString());let e=n.stdout.toString().trim();if(!(n.status!==0||!e.length))switch(t){case"fish":return e.slice(14).trim();case"pwsh":return e.slice(11).trim();case"bash":{let r=/([0-9]+).([0-9]+).([0-9]+)/,o=e.match(r);if(o)return o.slice(1,3).join(".")}case"cmd":return e.replaceAll(`\r
`,`
`).split(`
`).at(0)?.split(" ").at(-1)?.split("]").at(0)?.trim();case"ksh":return e.split("/").at(1)?.split(" ").at(1)?.trim();case"zsh":return e.split(" ").at(1)?.trim();case"tcsh":return e.split(" ").at(1)?.trim();case"powershell":case"nu":return e}}function l(t){return t.replaceAll("\\","/").split("/").at(-1)?.split(".").at(0)?.trim()}function S(t){if(f(t))return{shell:t,version:h(t)}}function d(){let t=process.pid,n=(process.platform==="win32"?c:u)(t);for(console.log("name",n);t;){let e=g(t);if(!e)break;t=e.pid,n=e.name;let r=S(n);if(r)return r}}console.log(d());
